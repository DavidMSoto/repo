---
title: "othersLondonCrime"
output: html_document

---

Before being a Data Scientist, I remind you to:

    Learn to tell stories ("storytelling")
    Learn to communicate to non-technical people (they don't care about your "xgboost with 1,000,000 interactions and 10,000 trees giving 0.99328 AUC that took days to compute" when the model of your friend is a "linear regression giving 0.987 AUC with coefficients applied to 3 features in 15 seconds")
    Learn to teach/train (because you need to learn to communicate properly)
    Learn to be a creative person / designer (someone who can bissociate stuff [merge two different stuff] and also incorporate sociocultural elements in a project, product, process...)
    Learn to take vacations =)


```{r read, include=FALSE}

rm(list = ls())
library(data.table)
library(ggplot2) # graph
library(plotly)  # grapgh

library(tidyr)   #separate
library(dplyr)#select


system('ls -lh ./../input/2016-07/' )

WIN <- FALSE
if (WIN) {setwd("c:/repo/crime/code/")} else{setwd("~/dataScience/projects/repo/crime/code/")}

#path <-'../input/2016-07/2016-07-metropolitan-street.csv'
#path <-'../input/2016-07/2016-07-bedfordshire-street.csv'
path <-'../input/everything.csv'
#path <- '../input/metropolitan_2010_2016.csv'


e=fread(path, colClasses=c(Longitude="character",Latitude="character"),
header=T, sep=",", verbose = FALSE, showProgress = FALSE) %>% as.data.frame() # SILENCE


e$Context<-NULL #unnecessary duplicate to char_2

names(e) <- c( "CrimeID"  , "Month"  ,  "Reportedby"    ,  "Fallswithin" ,  
 "Longitude"   ,   "Latitude"     ,      "Location"    ,    "LSOAcode"     ,       
 "LSOAname"     ,        "Crimetype"   ,         "Lastoutcomecategory")


```



```{r preprocesing, tidy=T}



row.has.na <- apply(e, 1, function(x){any(is.na(x))})
sum(row.has.na)
e <- e[!row.has.na,]

 #why na omit doesnÂ´t work ??
unique(e$Month)
e<-e[-which(e$Month=="Month"), ] 
e<-e[-which(e$Latitude==""), ] 

vars <- c("year", "month")
e <- separate(e, Month, into = vars, sep = "-")
e = filter(e, as.integer(year) < 2016)

##subsetting
crimes <- subset(e,   Crimetype =='Drugs',
select=c(year, month,  Longitude,Latitude,LSOAcode,LSOAname,Crimetype)) 



```


## Analisys

lets see year by crime


```{#anaysis}

showmap(crimes)

showYearCrime(e,year)
showplotYearCrime(e)
```



```{r functions, tidy=T}
showplotYearCrime = function(dataset) {

by_year_and_crime = dataset %>%
  group_by(year, Crimetype) %>% summarise(count=n())

ggplot(data=by_year_and_crime, aes(x=year, y=count)) +
  ggtitle("Number of offense insidents 2010 2106") +
  xlab("Year  2010 2106") +
  ylab("Number of incidents") + 
  geom_point(aes(color=Crimetype), size=5.0) + 
  geom_line(aes(color=Crimetype), size=2.0)

}

showYearCrime = function(dataset, column) {
  dataset<-e
  column <-year
temp <- dataset %>% select(Crimetype,column)
#temp <- temp %>% group_by(year,Crimetype) %>% summarise(n=n())
temp <- temp %>% group_by(column) %>% summarise(n=n())

temp <- na.omit(temp)
p <- plot_ly(temp, x = column, y = n, name = "Number of crimes by Year")
p %>%
  add_trace(y = fitted(loess(n ~ as.numeric(column))), x = column) %>%
  layout(title = "Year and Crimes",
         showlegend = FALSE) %>%
  dplyr::filter(n == max(n)) %>%
  layout(annotations = list(x = column, y = n, text = "Peak", showarrow = T))

}

my.function <- function(data, col){
   data[, col]
 }

showmap = function(dataset) {
  library(leaflet)
  
  m <- leaflet() %>%
    addTiles() %>%  # Add default OpenStreetMap map tiles
    addMarkers(lng=as.integer(dataset$Longitude), lat=as.integer(dataset$Latitude),
               popup=dataset$Crimetype,
               clusterOptions = markerClusterOptions())
  m  # Print the map
}
```

