---
title: "othersLondonCrime"
output: html_document

---

Before being a Data Scientist, I remind you to:

    Learn to tell stories ("storytelling")
    Learn to communicate to non-technical people (they don't care about your "xgboost with 1,000,000 interactions and 10,000 trees giving 0.99328 AUC that took days to compute" when the model of your friend is a "linear regression giving 0.987 AUC with coefficients applied to 3 features in 15 seconds")
    Learn to teach/train (because you need to learn to communicate properly)
    Learn to be a creative person / designer (someone who can bissociate stuff [merge two different stuff] and also incorporate sociocultural elements in a project, product, process...)
    Learn to take vacations =)


```{r read, include=FALSE}

rm(list = ls())
library(data.table)
library(Matrix)
library(ggplot2)
library(tidyr)   #separate
require(MASS)
library(plotly)
library(dplyr)


system('ls -lh ./../input/2016-07/' )

WIN <- FALSE
if (WIN) {setwd("~//R//Rossmann")} else{setwd("~/dataScience/projects/repo/crime/code/")}

#path <-'../input/2016-07/2016-07-metropolitan-street.csv'
#path <-'../input/2016-07/2016-07-bedfordshire-street.csv'
#path <-'../input/everything.csv'
path <- '../input/metropolitan_2010_2016.csv'


e=fread(path, header=T, sep=",", stringsAsFactors=F) 


e$Context<-NULL #unnecessary duplicate to char_2

names(e) <- c( "CrimeID"  , "Month"  ,  "Reportedby"    ,  "Fallswithin" ,  
 "Longitude"   ,   "Latitude"     ,      "Location"    ,    "LSOAcode"     ,       
 "LSOAname"     ,        "Crimetype"   ,         "Lastoutcomecategory")

 #why na omit doesnÂ´t work ??
unique(e$Month)
e<-e[-which(e$Month=="Month"), ] 
vars <- c("year", "month")
e <- separate(e, Month, into = vars, sep = "-")
t_2010_to_2015 = filter(e, as.integer(year) < 2016)
rm(e)

```



```{r preprocesing, tidy=T}




row.has.na <- apply(crimes, 1, function(x){any(is.na(x))})
sum(row.has.na)
e <- e[!row.has.na,]



names(t_2010_to_2015)

##subsetting
crimes <- subset(t_2010_to_2015,  # Crimetype =='Drugs',
select=c(year, month,  Longitude,Latitude,LSOAcode,LSOAname,Crimetype)) 



tail(crimes_t_2010_to_2015)

crimes_t_2010_to_2015<-t_2010_to_2015[-which(t_2010_to_2015$Longitude==""), ] 


```


## Analisys

lets see year by crime


```{#anaysis}

showmap(crimes)

showgrap(e)

```

### Analysis by year

```{r, tidy=T}

by_year_and_crime = crimes %>%
  group_by(year, Crimetype) %>% summarise(count=n())

ggplot(data=by_year_and_crime, aes(x=year, y=count)) +
  ggtitle("Number of offense insidents 2010 2106") +
  xlab("Year  2010 2106") +
  ylab("Number of incidents") + 
  geom_point(aes(color=Crimetype), size=5.0) + 
  geom_line(aes(color=Crimetype), size=2.0)



names(t_2010_to_2015)
tail(crimes)
temp <- t_2010_to_2015 %>% select(Crimetype,year)
#temp <- temp %>% group_by(year,Crimetype) %>% summarise(n=n())
temp <- temp %>% group_by(year) %>% summarise(n=n())

temp <- na.omit(temp)
p <- plot_ly(temp, x = year, y = n, name = "Number of crimes by Year")
p %>%
  add_trace(y = fitted(loess(n ~ as.numeric(year))), x = year) %>%
  layout(title = "Year and Crimes",
         showlegend = FALSE) %>%
  dplyr::filter(n == max(n)) %>%
  layout(annotations = list(x = year, y = n, text = "Peak", showarrow = T))


```


```{fuctions}


showmap = function(dataset) {
  library(leaflet)
  
  m <- leaflet() %>%
    addTiles() %>%  # Add default OpenStreetMap map tiles
    addMarkers(lng=dataset$Longitude, lat=dataset$Latitude,
               popup=dataset$Crime.type,
               clusterOptions = markerClusterOptions())
  m  # Print the map
}
```

